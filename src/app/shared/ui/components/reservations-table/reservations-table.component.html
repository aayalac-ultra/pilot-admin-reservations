<div class="reservations-table-container">
  <!-- Search and Actions Bar -->
  <div class="table-header">
    <div class="search-section">
      <span class="p-input-icon-left">
        <i class="pi pi-search"></i>
        <input
          pInputText
          placeholder="Buscar por PNR, comprador, email, oferta..."
          class="search-input"
          [(ngModel)]="filters.global"
          (input)="onFilterChange()"
          [disabled]="loading">
      </span>
    </div>

    <div class="actions-section">
      <p-button
        label="Filtros"
        icon="pi pi-filter"
        styleClass="p-button-outlined"
        [badge]="hasActiveFilters() ? '1' : ''"
        badgeClass="p-badge-info">
      </p-button>

      <p-button
        label="Exportar"
        icon="pi pi-download"
        styleClass="p-button-outlined"
        (onClick)="onExport()"
        [loading]="exporting">
      </p-button>
    </div>
  </div>

  <!-- Table Info and Pagination Controls -->
  <div class="table-controls">
    <div class="table-info">
      <label>
        <input type="checkbox" class="select-all-checkbox">
        {{ pagination.totalItems }} reservas
      </label>
    </div>

    <div class="pagination-controls">
      <span class="pagination-info">Mostrar:</span>
      <p-dropdown
        [options]="[{label: '20', value: 20}, {label: '50', value: 50}, {label: '100', value: 100}]"
        [(ngModel)]="pagination.size"
        styleClass="pagination-dropdown">
      </p-dropdown>
      <span class="pagination-info">Anterior</span>
      <span class="pagination-current">PÃ¡gina 1 de 1</span>
      <span class="pagination-info">Siguiente</span>
    </div>
  </div>

  <!-- Responsive Table Wrapper -->
  <div class="table-wrapper">
    <p-table
      [value]="reservations"
      [loading]="loading"
      [paginator]="false"
      [sortMode]="'single'"
      styleClass="reservations-table"
      (onLazyLoad)="onTableEvent($event)"
      [dataKey]="'id'"
      [tableStyle]="{'min-width': '1000px'}"
      loadingIcon="pi pi-spinner pi-spin">

      <!-- Empty Template -->
      <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="7" class="empty-state">
            <i class="pi pi-inbox"></i>
            <div class="empty-title">No hay reservas</div>
            <div class="empty-subtitle">No se encontraron reservas con los filtros actuales</div>
          </td>
        </tr>
      </ng-template>

      <!-- Header -->
      <ng-template pTemplate="header">
        <tr>
          <th class="checkbox-column">
            <input type="checkbox" class="header-checkbox">
          </th>
          <th pSortableColumn="pnr" class="pnr-column">
            PNR <p-sortIcon field="pnr"></p-sortIcon>
          </th>
          <th pSortableColumn="createdAt" class="date-column">
            FECHA <p-sortIcon field="createdAt"></p-sortIcon>
          </th>
          <th class="buyer-column">COMPRADOR</th>
          <th class="offer-column">OFERTA</th>
          <th class="status-column">ESTADO</th>
          <th class="payment-column">PAGO</th>
          <th class="amount-column">MONTO</th>
        </tr>
      </ng-template>

      <!-- Body -->
      <ng-template pTemplate="body" let-reservation>
        <tr class="table-row" (click)="onViewReservation(reservation)">
          <td class="checkbox-cell">
            <input type="checkbox" (click)="$event.stopPropagation()">
          </td>

          <td class="pnr-cell">
            <span class="pnr-code">{{ reservation.pnr }}</span>
          </td>

          <td class="date-cell">
            <div class="date-info">
              <div class="date-primary">{{ formatDate(reservation.createdAt) }}</div>
              <div class="date-secondary">{{ getLocationText(reservation) }}</div>
            </div>
          </td>

          <td class="buyer-cell">
            <div class="buyer-info">
              <div class="buyer-name">{{ reservation.customerName }}</div>
              <div class="buyer-email">{{ reservation.customerEmail }}</div>
            </div>
          </td>

          <td class="offer-cell">
            <div class="offer-info">
              <div class="offer-title">{{ getOfferTitle(reservation) }}</div>
              <div class="offer-provider">{{ getOfferProvider(reservation) }}</div>
            </div>
          </td>

          <td class="status-cell">
            <p-tag
              [value]="getStatusLabel(reservation.status)"
              [severity]="uiConfig.getStatusSeverity(reservation.status)"
              styleClass="status-tag">
            </p-tag>
          </td>

          <td class="payment-cell">
            <p-tag
              [value]="getPaymentStatusLabel(reservation.paymentStatus)"
              [severity]="uiConfig.getPaymentStatusSeverity(reservation.paymentStatus)"
              styleClass="payment-tag">
            </p-tag>
          </td>

          <td class="amount-cell">
            <div class="amount-value">{{ uiConfig.formatCurrency(reservation.totalAmount, reservation.currency) }}</div>
          </td>
        </tr>
      </ng-template>
    </p-table>
  </div>
</div>

<p-confirmDialog></p-confirmDialog>